@{
    ViewData["Title"] = "Hərəkət loqları";
}

<div class="container-fluid">
    <h4 class="mb-4">Hərəkət loqları</h4>

    <div class="card shadow-sm border-0">
        <div class="card-body position-relative" style="min-height: 400px;">
            <table id="logsTable" class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>İstifadəçi</th>
                        <th>Metod</th>
                        <th>Yol</th>
                        <th class="text-center">Status</th>
                        <th>Tarix</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/logs.js"></script>
    <script>
        $(function () {
            window.dttbidsmxbb.initLogsTable({
                url: '@Url.Action("LoadEventLogs", "Logs")',
                columns: [
                    {
                        data: 'userFullName',
                        defaultContent: '<span class="text-muted fst-italic">Anonim</span>',
                        className: 'fw-medium'
                    },
                    {
                        data: 'method',
                        render: function (data) {
                            const colors = { 'GET': 'primary', 'POST': 'success', 'PUT': 'warning', 'DELETE': 'danger', 'PATCH': 'info' };
                            const variant = colors[data] || 'secondary';
                            return '<span class="badge bg-' + variant + '">' + data + '</span>';
                        }
                    },
                    {
                        data: 'path',
                        className: 'font-monospace small',
                        render: function (data) {
                            if (data.length > 60) return '<span title="' + data + '">' + data.substring(0, 60) + '...</span>';
                            return data;
                        }
                    },
                    {
                        data: 'statusCode',
                        className: 'text-center',
                        render: function (data) {
                            let variant = 'secondary';
                            if (data >= 200 && data < 300) variant = 'success';
                            else if (data >= 300 && data < 400) variant = 'info';
                            else if (data >= 400 && data < 500) variant = 'warning';
                            else if (data >= 500) variant = 'danger';
                            return '<span class="badge bg-' + variant + '">' + data + '</span>';
                        }
                    },
                    { data: 'timestamp', render: window.dttbidsmxbb.formatTimestamp }
                ]
            });
        });
    </script>
}